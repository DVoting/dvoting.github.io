import{r as o,j as e,W as z,N as $,a as s,C as B,b as R,c as U,F as m,d as J,e as K,f as Q,V as X,R as P,g as b,A as Y,S as Z,h as E,u as V,i as D,k as n,B as G,L as j,l as ee,T as te,m as re,O as se,n as ae,o as oe,p as ne,q as I,s as le}from"./vendor.9faf117f.js";const ie=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))d(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const p of c.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&d(p)}).observe(document,{childList:!0,subtree:!0});function a(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerpolicy&&(c.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?c.credentials="include":l.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function d(l){if(l.ep)return;l.ep=!0;const c=a(l);fetch(l.href,c)}};ie();const C=o.exports.createContext({user:null,walletId:null,isAuth:!1,loading:!1}),ce=r=>{const[t,a]=o.exports.useState(""),[d,l]=o.exports.useState(null),[c,p]=o.exports.useState(!1),[S,f]=o.exports.useState(!1);return e(C.Provider,{value:{user:d,setUser:l,walletId:t,setWalletId:a,isAuth:c,setIsAuth:p,loading:S,setLoading:f},children:r.children})},de=()=>{let r;return window.ethereum?(console.log("MetaMask is installed!"),r=new z(window.ethereum),window.ethereum.request({method:"eth_requestAccounts"}).then(t=>{console.log(t)}).catch(console.log)):console.log("MetaMask is NOT installed!"),r},H=()=>{const{user:r,setUser:t,isAuth:a,setIsAuth:d,setLoading:l}=o.exports.useContext(C),c=()=>{localStorage.removeItem("token"),d(!1),t(null),l(!1)};return e("header",{children:e($,{children:s(B,{children:[e(R.LinkContainer,{to:a?"/dashboard":"/",children:e($.Brand,{children:"DVoting"})}),e($.Toggle,{"aria-controls":"basic-navbar-nav"}),e(U,{className:"ml-auto",children:r?e(m,{children:s(J,{children:[r.name,e(R.LinkContainer,{to:"#",onClick:c,children:s(U.Link,{children:[e(K,{})," ","Logout"]})})]})}):s(m,{children:[e(R.LinkContainer,{to:"/login",children:s(U.Link,{children:[e(Q,{})," ","Log In"]})}),e(R.LinkContainer,{to:"/signup",children:s(U.Link,{children:[e(X,{})," ","SignUp"]})})]})})]})})})},M=({children:r})=>e(B,{children:e(P,{className:"justify-content-md-center",children:e(b,{xs:12,md:6,children:r})})}),q=({variant:r,children:t})=>e(Y,{variant:r,children:t});q.defaultProps={variant:"info"};const A=()=>e(Z,{animation:"border",role:"status",style:{width:"4vh",height:"4vh",margin:"25vh auto",display:"block",color:"black"}}),ue=()=>{const{walletId:r,setWalletId:t,loading:a}=o.exports.useContext(C);return o.exports.useEffect(()=>{(async()=>{const d=de();if(d){let l=await d.eth.getAccounts();t(l[0])}})()},[r]),e(m,{children:a?e(A,{}):s(m,{children:[e(H,{}),e("div",{children:"Voting App - Client..."})]})})},N="https://dvoting-server.vercel.app/api",he=async r=>{try{const t={headers:{"Content-Type":"application/json"}},a=await E.post(`${N}/users/login`,r,t);return localStorage.setItem("token",a.data.token),a.data}catch(t){throw t}},pe=async()=>{const r=localStorage.getItem("token"),t={headers:{"Content-type":"application/json",Authorization:`Bearer ${r}`}};try{const{data:a}=await E.get(`${N}/users/profile`,t);return a}catch(a){return console.log(a),a}},ge=async r=>{try{const t={headers:{"Content-Type":"application/json"}},a=await E.post(`${N}/users`,r,t);return localStorage.setItem("token",a.data.token),a.data}catch(t){throw t}},me=()=>{const[r,t]=o.exports.useState(""),[a,d]=o.exports.useState(""),[l,c]=o.exports.useState(!1),p=V(),S=D(),f=p.search?p.search.split("=")[1]:"/",{isAuth:u,setIsAuth:L,loading:v,setLoading:h}=o.exports.useContext(C);return o.exports.useEffect(()=>{L("token"in localStorage),u&&(h(!1),S("/dashboard",{replace:!0}))},[u]),e(m,{children:v?e(A,{}):s(m,{children:[e(H,{}),e("div",{children:s(M,{children:[e("h1",{children:"Login"}),l&&e(q,{variant:"danger",children:l}),s(n,{onSubmit:async g=>{g.preventDefault(),h(!0);try{await he({email:r,password:a}),L("token"in localStorage)}catch(w){console.log(w),w.response&&w.response.data.message?c(w.response.data.message):c(w.message)}h(!1)},onReset:g=>{g.preventDefault(),t(""),d("")},children:[s(n.Group,{controlId:"email",children:[e(n.Label,{children:"Email Address"}),e(n.Control,{type:"email",placeholder:"Enter email",value:r,required:!0,onChange:g=>{c(!1),t(g.target.value)}})]}),s(n.Group,{controlId:"password",children:[e(n.Label,{children:"Password"}),e(n.Control,{type:"password",placeholder:"Enter password",value:a,required:!0,onChange:g=>{c(!1),d(g.target.value)}})]}),s(P,{className:"py-3",children:[e(b,{children:e(G,{type:"submit",variant:"primary",children:"Sign In"})}),e(b,{children:e(G,{type:"reset",variant:"primary",children:"Reset"})})]}),s(P,{children:[s(b,{children:["New User?"," ",e(j,{to:f?`/signup?redirect=${f}`:"/signup",children:"Register Here"})]}),s(b,{children:["Forgot Password?"," ",e(j,{to:f?`/forgotpassword?redirect=${f}`:"/forgotpassword",children:"Click here"})]})]})]})]})})]})})},fe=[{name:"Organiser",value:"organiser"},{name:"Voter",value:"voter"}],ve=[{name:"Email not entered",value:"1"},{name:"OTP sent from server",value:"2"},{name:"Change password",value:"3"}],ye=()=>{const[r,t]=o.exports.useState(""),[a,d]=o.exports.useState(""),[l,c]=o.exports.useState(""),[p,S]=o.exports.useState(""),[f,u]=o.exports.useState("voter"),[L,v]=o.exports.useState(!1),h=V(),T=D(),O=h.search?h.search.split("=")[1]:"/",{isAuth:g,setIsAuth:w,loading:F,setLoading:y}=o.exports.useContext(C);return o.exports.useEffect(()=>{w("token"in localStorage),g&&(y(!1),T("/dashboard",{replace:!0}))},[g]),e(m,{children:F?e(A,{}):s(m,{children:[e(H,{}),e("div",{children:s(M,{children:[e("h1",{children:"SignUp"}),L&&e(q,{variant:"danger",children:L}),s(n,{onSubmit:async i=>{i.preventDefault(),y(!0);try{await ge({username:a,email:l,password:p,name:r,userType:f}),w("token"in localStorage)}catch(k){console.log(k),k.response&&k.response.data.message?v(k.response.data.message):v(k.message)}y(!1)},onReset:i=>{i.preventDefault(),t(""),d(""),c(""),S(""),u("voter")},children:[s(n.Group,{controlId:"name",children:[e(n.Label,{children:"Name"}),e(n.Control,{type:"text",placeholder:"Enter name",value:r,required:!0,onChange:i=>{v(!1),t(i.target.value)}})]}),s(n.Group,{controlId:"username",children:[e(n.Label,{children:"Username"}),e(n.Control,{type:"text",placeholder:"Enter username",value:a,required:!0,onChange:i=>{v(!1),d(i.target.value)}})]}),s(n.Group,{controlId:"email",children:[e(n.Label,{children:"Email Address"}),e(n.Control,{type:"email",placeholder:"Enter email",value:l,required:!0,onChange:i=>{v(!1),c(i.target.value)}})]}),s(n.Group,{controlId:"password",children:[e(n.Label,{children:"Password"}),e(n.Control,{type:"password",placeholder:"Enter password",value:p,required:!0,onChange:i=>{v(!1),S(i.target.value)}})]}),s(n.Group,{controlId:"userType",children:[e(n.Label,{children:"User Type"}),e("br",{}),e(ee,{children:fe.map((i,k)=>e(te,{id:`radio-${k}`,type:"radio",variant:"outline-dark",name:"radio",value:i.value,checked:f===i.value,onChange:_=>u(_.currentTarget.value),children:i.name},k))})]}),s(P,{className:"py-3",children:[e(b,{children:e(G,{type:"submit",variant:"primary",children:"Sign Up"})}),e(b,{children:e(G,{type:"reset",variant:"primary",children:"Reset"})})]}),e(P,{children:s(b,{children:["Already registered?"," ",e(j,{to:O?`/login?redirect=${O}`:"/signup",children:"Login Here"})]})})]})]})})]})})},we=()=>{const{user:r,loading:t,setLoading:a}=o.exports.useContext(C);return o.exports.useEffect(()=>{a(r===null)},[r]),e(m,{children:t?e(A,{}):s(m,{children:[e(H,{}),s("div",{children:["User Dashboard",JSON.stringify(r)]})]})})},xe=()=>e("div",{children:"Election Page"}),be=async r=>{try{const t={headers:{"Content-Type":"application/json"}};return(await E.put(`${N}/otp`,r,t)).data}catch(t){throw t}},Ce=async r=>{try{const t={headers:{"Content-Type":"application/json"}};return(await E.patch(`${N}/otp/verify`,r,t)).data}catch(t){throw t}},Se=async r=>{try{const t={headers:{"Content-Type":"application/json"}};return(await E.put(`${N}/users/profile`,r,t)).data}catch(t){throw t}},Le=()=>{const[r,t]=o.exports.useState(""),[a,d]=o.exports.useState(""),[l,c]=o.exports.useState(""),[p,S]=o.exports.useState(""),[f,u]=o.exports.useState(!1),[L,v]=o.exports.useState(!1),[h,T]=o.exports.useState(ve[0].value),O=D(),{isAuth:g,setIsAuth:w,loading:F,setLoading:y}=o.exports.useContext(C);return o.exports.useEffect(()=>{w("token"in localStorage),g&&(y(!1),O("/dashboard",{replace:!0}))},[g]),e(m,{children:F?e(A,{}):s(m,{children:[e(H,{}),e("div",{children:s(M,{children:[e("h1",{children:"Forgot Password"}),L&&e(q,{variant:"success",children:L}),f&&e(q,{variant:"danger",children:f}),s(n,{onSubmit:async x=>{if(x.preventDefault(),u(!1),v(!1),l!==p){u("Passwords don't match");return}switch(h){case"1":y(!0);try{await be({email:r}),T("2")}catch(i){console.log(i),i.response&&i.response.data.message?u(i.response.data.message):u(i.message)}y(!1);break;case"2":y(!0);try{await Ce({email:r,otp:a}),T("3")}catch(i){console.log(i),i.response&&i.response.data.message?u(i.response.data.message):u(i.message)}y(!1);break;case"3":y(!0);try{await Se({email:r,password:l}),v("Password has been changed")}catch(i){console.log(i),i.response&&i.response.data.message?u(i.response.data.message):u(i.message)}y(!1);break}},children:[(h==="1"||h==="2")&&s(n.Group,{controlId:"email",children:[e(n.Label,{children:"Email Address"}),e(n.Control,{type:"email",placeholder:"Enter your email",value:r,required:!0,onChange:x=>{u(!1),t(x.target.value)}})]}),h==="2"&&s(n.Group,{controlId:"otp",children:[e(n.Label,{children:"OTP"}),e(n.Control,{type:"text",placeholder:"Enter OTP received on email",value:a,required:!0,onChange:x=>{u(!1),d(x.target.value)}})]}),h==="3"&&s(n.Group,{controlId:"password",children:[e(n.Label,{children:"Password"}),e(n.Control,{type:"password",placeholder:"Enter new Password",value:l,required:!0,onChange:x=>{u(!1),c(x.target.value)}})]}),h==="3"&&s(n.Group,{controlId:"confirmPassword",children:[e(n.Label,{children:"Confirm Password"}),e(n.Control,{type:"password",placeholder:"Confirm your new Password",value:p,required:!0,onChange:x=>{u(!1),S(x.target.value)}})]}),e(P,{className:"py-3",children:e(b,{children:e(G,{type:"submit",variant:"primary",children:h=="1"?"Send OTP":h=="2"?"Confirm OTP":"Change Password"})})})]})]})})]})})};var ke="/assets/fourOfour.e2f25f95.jpeg";const Ie=()=>{const{loading:r,isAuth:t,setIsAuth:a}=o.exports.useContext(C);return o.exports.useEffect(()=>{a("token"in localStorage)}),e("div",{children:r?e(A,{}):s(m,{children:[s(j,{to:t?"/dashboard":"/",children:[e(re,{}),"Go back to the home page"]}),e("img",{src:ke})]})})},Pe=()=>{const{user:r,setUser:t,setIsAuth:a}=o.exports.useContext(C),d=localStorage.getItem("token");return r||o.exports.useEffect(()=>{(async()=>{if(d){const l=await pe();t(l),a(!0)}})()},[d]),console.log("via private route"),d?e(se,{}):e(ae,{to:"/login"})},Ee=()=>e(oe,{children:e("main",{className:"App py-3 bg-gray",children:e(B,{children:s(ne,{children:[e(I,{path:"*",element:e(Ie,{})}),e(I,{exact:!0,path:"/",element:e(ue,{})}),e(I,{path:"/login",element:e(me,{})}),e(I,{path:"/signup",element:e(ye,{})}),e(I,{path:"/forgotpassword",element:e(Le,{})}),s(I,{path:"/",element:e(Pe,{}),children:[e(I,{exact:!0,path:"/dashboard",element:e(we,{})}),e(I,{exact:!0,path:"/election",element:e(xe,{})})]})]})})})});le.render(e(ce,{children:e(Ee,{})}),document.getElementById("root"));
