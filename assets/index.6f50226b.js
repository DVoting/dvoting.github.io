var se=Object.defineProperty,ae=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Q=(t,r,s)=>r in t?se(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,H=(t,r)=>{for(var s in r||(r={}))oe.call(r,s)&&Q(t,s,r[s]);if(K)for(var s of K(r))le.call(r,s)&&Q(t,s,r[s]);return t},$=(t,r)=>ae(t,ne(r));import{r as o,j as e,W as B,a,R as X,t as Y,N as M,C as W,b as j,c as G,F as w,d as ie,e as ce,f as de,V as ue,B as he,g as Z,h as T,i as k,A as pe,S as ge,k as L,u as _,l as V,m as i,n as E,L as F,o as ee,D as te,p as me,O as fe,q as ve,s as we,v as I,T as ye,w as be}from"./vendor.63140f87.js";const Ce=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&u(h)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function u(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}};Ce();const C=o.exports.createContext({user:null,walletId:null,isAuth:!1,loading:!1}),xe=t=>{const[r,s]=o.exports.useState(""),[u,n]=o.exports.useState(null),[l,h]=o.exports.useState(!1),[y,m]=o.exports.useState(!1);return e(C.Provider,{value:{user:u,setUser:n,walletId:r,setWalletId:s,isAuth:l,setIsAuth:h,loading:y,setLoading:m},children:t.children})};let z;if(window.ethereum)console.log("MetaMask is installed!"),z=new B(window.ethereum);else{console.log("MetaMask is NOT installed!");const t=new B.providers.HttpProvider("https://polygon-rpc.com",{chainId:137,name:"matic"});z=new B(t)}var Se=z;const ke=(t,r)=>a(X.Fragment,{children:[e("span",{children:t||""}),e("br",{}),e("span",{children:r||""})]});function Ie(t){var s;let r=(s=JSON.parse(localStorage.getItem("walletDisabled")))!=null?s:!1;console.log(r),window.ethereum&&(Se.eth.getAccounts().then(u=>{r||t(u[0]||"")}).catch(console.log),window.ethereum.on("accountsChanged",u=>{var l;((l=JSON.parse(localStorage.getItem("walletDisabled")))!=null?l:!1)||t(u[0]||"")}))}async function Le(t){localStorage.setItem("walletDisabled",!0),t("")}async function Ee(t){if(!window.ethereum){Y.error(ke("Provider Error","MetaMask is NOT installed!"),{position:Y.POSITION.BOTTOM_RIGHT,autoClose:5e3,toastId:"providerError",closeOnClick:!0,pauseOnHover:!1,draggable:!1});return}localStorage.setItem("walletDisabled",!1);try{const r=await window.ethereum.request({method:"eth_requestAccounts"});t(r[0]||"")}catch(r){console.log(r)}}const q=()=>{const{user:t,setUser:r,isAuth:s,setIsAuth:u,setLoading:n}=o.exports.useContext(C),{walletId:l,setWalletId:h}=o.exports.useContext(C),y=()=>{localStorage.removeItem("token"),u(!1),r(null),n(!1)};return X.useEffect(()=>Ie(h),[]),e("header",{children:e(M,{children:a(W,{children:[e(j.LinkContainer,{to:s?"/dashboard":"/",children:e(M.Brand,{children:"DVoting"})}),e(M.Toggle,{"aria-controls":"basic-navbar-nav"}),a(G,{className:"ml-auto",children:[t?e(w,{children:a(ie,{children:[t.name,e(j.LinkContainer,{to:"#",onClick:y,children:a(G.Link,{children:[e(ce,{})," ","Logout"]})})]})}):a(w,{children:[e(j.LinkContainer,{to:"/login",children:a(G.Link,{children:[e(de,{})," ","Log In"]})}),e(j.LinkContainer,{to:"/signup",children:a(G.Link,{children:[e(ue,{})," ","SignUp"]})})]}),l===""?a(G.Link,{onClick:()=>Ee(h),children:[e(he,{size:20})," ","Connect Wallet"]}):e(Z,{title:l.slice(0,4)+"..."+l.slice(-4),children:e(Z.Item,{onClick:()=>Le(h),children:"Disconnect"})})]})]})})})},J=({children:t})=>e(W,{children:e(T,{className:"justify-content-md-center",children:e(k,{xs:12,md:6,children:t})})}),D=({variant:t,children:r})=>e(pe,{variant:t,children:r});D.defaultProps={variant:"info"};const A=()=>e(ge,{animation:"border",role:"status",style:{width:"4vh",height:"4vh",margin:"25vh auto",display:"block",color:"black"}}),Pe=()=>{const{loading:t}=o.exports.useContext(C);return e(w,{children:t?e(A,{}):a(w,{children:[e(q,{}),e("div",{children:"Voting App - Client..."})]})})},P="https://dvoting-server.vercel.app/api",Te=async t=>{try{const r={headers:{"Content-Type":"application/json"}},s=await L.post(`${P}/users/login`,t,r);return localStorage.setItem("token",s.data.token),s.data}catch(r){throw r}},De=async()=>{const t=localStorage.getItem("token"),r={headers:{"Content-type":"application/json",Authorization:`Bearer ${t}`}};try{const{data:s}=await L.get(`${P}/users/profile`,r);return s}catch(s){return console.log(s),s}},Ae=async t=>{try{const r={headers:{"Content-Type":"application/json"}},s=await L.post(`${P}/users`,t,r);return localStorage.setItem("token",s.data.token),s.data}catch(r){throw r}},Oe=()=>{const[t,r]=o.exports.useState(""),[s,u]=o.exports.useState(""),[n,l]=o.exports.useState(!1),h=_(),y=V(),m=h.search?h.search.split("=")[1]:"/",{isAuth:d,setIsAuth:p,loading:f,setLoading:g}=o.exports.useContext(C);return o.exports.useEffect(()=>{p("token"in localStorage),d&&(g(!1),y("/dashboard",{replace:!0}))},[d]),e(w,{children:f?e(A,{}):a(w,{children:[e(q,{}),e("div",{children:a(J,{children:[e("h1",{children:"Login"}),n&&e(D,{variant:"danger",children:n}),a(i,{onSubmit:async v=>{v.preventDefault(),g(!0);try{await Te({email:t,password:s}),p("token"in localStorage)}catch(x){console.log(x),x.response&&x.response.data.message?l(x.response.data.message):l(x.message)}g(!1)},onReset:v=>{v.preventDefault(),r(""),u("")},children:[a(i.Group,{controlId:"email",children:[e(i.Label,{children:"Email Address"}),e(i.Control,{type:"email",placeholder:"Enter email",value:t,required:!0,onChange:v=>{l(!1),r(v.target.value)}})]}),a(i.Group,{controlId:"password",children:[e(i.Label,{children:"Password"}),e(i.Control,{type:"password",placeholder:"Enter password",value:s,required:!0,onChange:v=>{l(!1),u(v.target.value)}})]}),a(T,{className:"py-3",children:[e(k,{children:e(E,{type:"submit",variant:"primary",children:"Sign In"})}),e(k,{children:e(E,{type:"reset",variant:"primary",children:"Reset"})})]}),a(T,{children:[a(k,{children:["New User?"," ",e(F,{to:m?`/signup?redirect=${m}`:"/signup",children:"Register Here"})]}),a(k,{children:["Forgot Password?"," ",e(F,{to:m?`/forgotpassword?redirect=${m}`:"/forgotpassword",children:"Click here"})]})]})]})]})})]})})},Ne=()=>{const[t,r]=o.exports.useState(""),[s,u]=o.exports.useState(""),[n,l]=o.exports.useState(""),[h,y]=o.exports.useState(""),[m,d]=o.exports.useState("voter"),[p,f]=o.exports.useState(!1),g=_(),O=V(),N=g.search?g.search.split("=")[1]:"/",{isAuth:v,setIsAuth:x,loading:U,setLoading:b}=o.exports.useContext(C);return o.exports.useEffect(()=>{x("token"in localStorage),v&&(b(!1),O("/dashboard",{replace:!0}))},[v]),e(w,{children:U?e(A,{}):a(w,{children:[e(q,{}),e("div",{children:a(J,{children:[e("h1",{children:"SignUp"}),p&&e(D,{variant:"danger",children:p}),a(i,{onSubmit:async c=>{c.preventDefault(),b(!0);try{await Ae({username:s,email:n,password:h,name:t,userType:m}),x("token"in localStorage)}catch(R){console.log(R),R.response&&R.response.data.message?f(R.response.data.message):f(R.message)}b(!1)},onReset:c=>{c.preventDefault(),r(""),u(""),l(""),y(""),d("voter")},children:[a(i.Group,{controlId:"name",children:[e(i.Label,{children:"Name"}),e(i.Control,{type:"text",placeholder:"Enter name",value:t,required:!0,onChange:c=>{f(!1),r(c.target.value)}})]}),a(i.Group,{controlId:"username",children:[e(i.Label,{children:"Username"}),e(i.Control,{type:"text",placeholder:"Enter username",value:s,required:!0,onChange:c=>{f(!1),u(c.target.value)}})]}),a(i.Group,{controlId:"email",children:[e(i.Label,{children:"Email Address"}),e(i.Control,{type:"email",placeholder:"Enter email",value:n,required:!0,onChange:c=>{f(!1),l(c.target.value)}})]}),a(i.Group,{controlId:"password",children:[e(i.Label,{children:"Password"}),e(i.Control,{type:"password",placeholder:"Enter password",value:h,required:!0,onChange:c=>{f(!1),y(c.target.value)}})]}),a(T,{className:"py-3",children:[e(k,{children:e(E,{type:"submit",variant:"primary",children:"Sign Up"})}),e(k,{children:e(E,{type:"reset",variant:"primary",children:"Reset"})})]}),e(T,{children:a(k,{children:["Already registered?"," ",e(F,{to:N?`/login?redirect=${N}`:"/signup",children:"Login Here"})]})})]})]})})]})})},Re=()=>{const{user:t,loading:r,setLoading:s}=o.exports.useContext(C);return o.exports.useEffect(()=>{s(t===null)},[t]),e(w,{children:r?e(A,{}):a(w,{children:[e(q,{}),a("div",{children:["User Dashboard",JSON.stringify(t)]})]})})},He=()=>{const t=_();return console.log(t),e("div",{children:"Election Details Page"})};const $e=async(t,r)=>{const s=localStorage.getItem("token"),u={headers:{"Content-type":"application/json",Authorization:`Bearer ${s}`}},n=$(H({},t),{organiser:r,registrationLink:"https://dvoting.github.io"});console.log(n);try{const{data:l}=await L.post(`${P}/elections`,n,u);return l}catch(l){throw console.log(l),l}},Ge=()=>{const[t,r]=o.exports.useState({title:"",openTimestamp:new Date,closeTimestamp:new Date}),[s,u]=o.exports.useState(null),[n,l]=o.exports.useState(null),{user:h}=o.exports.useContext(C),y=async d=>{d.preventDefault();try{const p=await $e(t,h._id),{_id:f}=p;u(`/elections/${f}`)}catch(p){console.log(p.response),l(p.response.data)}},m=d=>{d.preventDefault(),u("/dashboard")};return s?e(ee,{to:s,replace:!0}):a("div",{children:[a(i,{onSubmit:y,onReset:m,children:[a(i.Group,{className:"mb-3",controlId:"electionTitle",children:[e(i.Label,{children:"Title"}),e(i.Control,{type:"text",placeholder:"Enter election title",value:t.title,onChange:d=>{r(p=>$(H({},p),{title:d.target.value}))}})]}),a("div",{children:[e("label",{children:"Election Start Time"}),e("br",{}),e(te,{onChange:d=>{r(p=>$(H({},p),{openTimestamp:d}))},value:t.openTimestamp,minDate:new Date})]}),a("div",{children:[e("label",{children:"Election End Time"}),e("br",{}),e(te,{onChange:d=>{r(p=>$(H({},p),{closeTimestamp:d}))},value:t.closeTimestamp,minDate:t.openTimestamp})]}),e("br",{}),e(E,{variant:"primary",type:"reset",children:"Discard"}),e(E,{variant:"primary",type:"submit",children:"Save"})]}),n&&e(D,{variant:"danger",children:n})]})},qe=[{name:"Email not entered",value:"1"},{name:"OTP sent from server",value:"2"},{name:"Change password",value:"3"}],je=async t=>{try{const r={headers:{"Content-Type":"application/json"}};return(await L.put(`${P}/otp`,t,r)).data}catch(r){throw r}},Fe=async t=>{try{const r={headers:{"Content-Type":"application/json"}};return(await L.patch(`${P}/otp/verify`,t,r)).data}catch(r){throw r}},Ue=async t=>{try{const r={headers:{"Content-Type":"application/json"}};return(await L.put(`${P}/users/profile`,t,r)).data}catch(r){throw r}},Be=()=>{const[t,r]=o.exports.useState(""),[s,u]=o.exports.useState(""),[n,l]=o.exports.useState(""),[h,y]=o.exports.useState(""),[m,d]=o.exports.useState(!1),[p,f]=o.exports.useState(!1),[g,O]=o.exports.useState(qe[0].value),N=V(),{isAuth:v,setIsAuth:x,loading:U,setLoading:b}=o.exports.useContext(C);return o.exports.useEffect(()=>{x("token"in localStorage),v&&(b(!1),N("/dashboard",{replace:!0}))},[v]),e(w,{children:U?e(A,{}):a(w,{children:[e(q,{}),e("div",{children:a(J,{children:[e("h1",{children:"Forgot Password"}),p&&e(D,{variant:"success",children:p}),m&&e(D,{variant:"danger",children:m}),a(i,{onSubmit:async S=>{if(S.preventDefault(),d(!1),f(!1),n!==h){d("Passwords don't match");return}switch(g){case"1":b(!0);try{await je({email:t}),O("2")}catch(c){console.log(c),c.response&&c.response.data.message?d(c.response.data.message):d(c.message)}b(!1);break;case"2":b(!0);try{await Fe({email:t,otp:s}),O("3")}catch(c){console.log(c),c.response&&c.response.data.message?d(c.response.data.message):d(c.message)}b(!1);break;case"3":b(!0);try{await Ue({email:t,password:n}),f("Password has been changed")}catch(c){console.log(c),c.response&&c.response.data.message?d(c.response.data.message):d(c.message)}b(!1);break}},children:[(g==="1"||g==="2")&&a(i.Group,{controlId:"email",children:[e(i.Label,{children:"Email Address"}),e(i.Control,{type:"email",placeholder:"Enter your email",value:t,required:!0,onChange:S=>{d(!1),r(S.target.value)}})]}),g==="2"&&a(i.Group,{controlId:"otp",children:[e(i.Label,{children:"OTP"}),e(i.Control,{type:"text",placeholder:"Enter OTP received on email",value:s,required:!0,onChange:S=>{d(!1),u(S.target.value)}})]}),g==="3"&&a(i.Group,{controlId:"password",children:[e(i.Label,{children:"Password"}),e(i.Control,{type:"password",placeholder:"Enter new Password",value:n,required:!0,onChange:S=>{d(!1),l(S.target.value)}})]}),g==="3"&&a(i.Group,{controlId:"confirmPassword",children:[e(i.Label,{children:"Confirm Password"}),e(i.Control,{type:"password",placeholder:"Confirm your new Password",value:h,required:!0,onChange:S=>{d(!1),y(S.target.value)}})]}),e(T,{className:"py-3",children:e(k,{children:e(E,{type:"submit",variant:"primary",children:g=="1"?"Send OTP":g=="2"?"Confirm OTP":"Change Password"})})})]})]})})]})})};var Me="/assets/fourOfour.e2f25f95.jpeg";const We=()=>{const{loading:t,isAuth:r,setIsAuth:s}=o.exports.useContext(C);return o.exports.useEffect(()=>{s("token"in localStorage)}),e("div",{children:t?e(A,{}):a(w,{children:[a(F,{to:r?"/dashboard":"/",children:[e(me,{}),"Go back to the home page"]}),e("img",{src:Me})]})})},_e=()=>{const{user:t,setUser:r,setIsAuth:s,setLoading:u}=o.exports.useContext(C),n=localStorage.getItem("token");return o.exports.useEffect(()=>{(async()=>{if(n&&!t){const l=await De();r(l),s(!0)}})()},[n]),console.log("via private route"),n?e(fe,{}):e(ee,{to:"/login"})},Ve=()=>a(ve,{children:[e("main",{className:"App py-3 bg-gray",children:e(W,{children:a(we,{children:[e(I,{path:"*",element:e(We,{})}),e(I,{exact:!0,path:"/",element:e(Pe,{})}),e(I,{path:"/login",element:e(Oe,{})}),e(I,{path:"/signup",element:e(Ne,{})}),e(I,{path:"/forgotpassword",element:e(Be,{})}),a(I,{path:"/",element:e(_e,{}),children:[e(I,{exact:!0,path:"/dashboard",element:e(Re,{})}),e(I,{exact:!0,path:"/elections/:id",element:e(He,{})}),e(I,{exact:!0,path:"/create-election",element:e(Ge,{})})]})]})})}),e(ye,{})]});be.render(e(xe,{children:e(Ve,{})}),document.getElementById("root"));
