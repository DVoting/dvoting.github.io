var le=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var re=(t,r,a)=>r in t?le(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,P=(t,r)=>{for(var a in r||(r={}))de.call(r,a)&&re(t,a,r[a]);if(te)for(var a of te(r))ue.call(r,a)&&re(t,a,r[a]);return t},A=(t,r)=>ie(t,ce(r));import{r as l,j as e,W as z,a as n,R as m,t as j,N as J,C as U,b as V,c as G,F as I,d as he,e as pe,f as me,V as ge,B as fe,g as ne,h as F,i as E,A as ve,S as ye,k as O,u as Q,l as X,m as i,n as D,L as x,M as W,o as we,p as R,q as v,T as be,s as _,v as Y,D as ae,w as Ce,O as xe,x as Se,y as Ie,z as T,E as Ee,G as Ne}from"./vendor.b1412d1e.js";const ke=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&c(h)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}};ke();const N=l.exports.createContext({user:null,walletId:null,isAuth:!1,loading:!1}),Le=t=>{const[r,a]=l.exports.useState(""),[c,o]=l.exports.useState(null),[s,h]=l.exports.useState(!1),[g,f]=l.exports.useState(!1);return e(N.Provider,{value:{user:c,setUser:o,walletId:r,setWalletId:a,isAuth:s,setIsAuth:h,loading:g,setLoading:f},children:t.children})};let Z;if(window.ethereum)console.log("MetaMask is installed!"),Z=new z(window.ethereum);else{console.log("MetaMask is NOT installed!");const t=new z.providers.HttpProvider("https://polygon-rpc.com",{chainId:137,name:"matic"});Z=new z(t)}var Te=Z;const se=(t,r)=>n(m.Fragment,{children:[e("span",{children:t||""}),e("br",{}),e("span",{children:r||""})]});function Pe(t){var a;let r=(a=JSON.parse(localStorage.getItem("walletDisabled")))!=null?a:!1;console.log(r),window.ethereum&&(Te.eth.getAccounts().then(c=>{r||t(c[0]||"")}).catch(console.log),window.ethereum.on("accountsChanged",c=>{var s;((s=JSON.parse(localStorage.getItem("walletDisabled")))!=null?s:!1)||t(c[0]||"")}))}async function Ae(t){localStorage.setItem("walletDisabled",!0),t("")}async function Oe(t){if(!window.ethereum){j.error(se("Provider Error","MetaMask is NOT installed!"),{position:j.POSITION.BOTTOM_RIGHT,autoClose:5e3,toastId:"providerError",closeOnClick:!0,pauseOnHover:!1,draggable:!1});return}localStorage.setItem("walletDisabled",!1);try{const r=await window.ethereum.request({method:"eth_requestAccounts"});t(r[0]||"")}catch(r){console.log(r)}}const De=()=>{const{user:t,setUser:r,isAuth:a,setIsAuth:c,setLoading:o}=l.exports.useContext(N),{walletId:s,setWalletId:h}=l.exports.useContext(N),g=()=>{localStorage.removeItem("token"),c(!1),r(null),o(!1)};return l.exports.useEffect(()=>Pe(h),[]),e("header",{children:e(J,{children:n(U,{children:[e(V.LinkContainer,{to:a?"/dashboard":"/",children:e(J.Brand,{children:"DVoting"})}),e(J.Toggle,{"aria-controls":"basic-navbar-nav"}),n(G,{className:"ml-auto",children:[t?e(I,{children:n(he,{children:[t.name,e(V.LinkContainer,{to:"#",onClick:g,children:n(G.Link,{children:[e(pe,{})," Logout"]})})]})}):n(I,{children:[e(V.LinkContainer,{to:"/login",children:n(G.Link,{children:[e(me,{})," Log In"]})}),e(V.LinkContainer,{to:"/signup",children:n(G.Link,{children:[e(ge,{})," SignUp"]})})]}),s===""?n(G.Link,{onClick:()=>Oe(h),children:[e(fe,{size:20})," Connect Wallet"]}):e(ne,{title:s.slice(0,4)+"..."+s.slice(-4),children:e(ne.Item,{onClick:()=>Ae(h),children:"Disconnect"})})]})]})})})},ee=({children:t})=>e(U,{children:e(F,{className:"justify-content-md-center",children:e(E,{xs:12,md:6,children:t})})}),q=({variant:t,children:r})=>e(ve,{variant:t,children:r});q.defaultProps={variant:"info"};const M=()=>e(ye,{animation:"border",role:"status",style:{width:"4vh",height:"4vh",margin:"25vh auto",display:"block",color:"black"}}),He=()=>{const{loading:t}=l.exports.useContext(N);return e(I,{children:t?e(M,{}):e(I,{children:e("div",{children:"Voting App - Client..."})})})},H="https://dvoting-server.vercel.app/api",Fe=async t=>{try{const r={headers:{"Content-Type":"application/json"}},a=await O.post(`${H}/users/login`,t,r);return localStorage.setItem("token",a.data.token),a.data}catch(r){throw r}},Re=async()=>{const t=localStorage.getItem("token"),r={headers:{"Content-type":"application/json",Authorization:`Bearer ${t}`}};try{const{data:a}=await O.get(`${H}/users/profile`,r);return A(P({},a),{error:!1})}catch(a){return console.log(a.response),A(P({},a),{error:!0})}},qe=async t=>{try{const r={headers:{"Content-Type":"application/json"}},a=await O.post(`${H}/users`,t,r);return localStorage.setItem("token",a.data.token),a.data}catch(r){throw r}},Me=()=>{const[t,r]=l.exports.useState(""),[a,c]=l.exports.useState(""),[o,s]=l.exports.useState(!1),h=Q(),g=X(),f=h.search?h.search.split("=")[1]:"/",{isAuth:d,setIsAuth:p,loading:b,setLoading:y}=l.exports.useContext(N);return l.exports.useEffect(()=>{p("token"in localStorage),d&&(y(!1),g("/dashboard",{replace:!0}))},[d]),e(I,{children:b?e(M,{}):e(I,{children:e("div",{children:n(ee,{children:[e("h1",{children:"Login"}),o&&e(q,{variant:"danger",children:o}),n(i,{onSubmit:async C=>{C.preventDefault(),y(!0);try{await Fe({email:t,password:a}),p("token"in localStorage)}catch(k){console.log(k),k.response&&k.response.data.message?s(k.response.data.message):s(k.message)}y(!1)},onReset:C=>{C.preventDefault(),r(""),c("")},children:[n(i.Group,{controlId:"email",children:[e(i.Label,{children:"Email Address"}),e(i.Control,{type:"email",placeholder:"Enter email",value:t,required:!0,onChange:C=>{s(!1),r(C.target.value)}})]}),n(i.Group,{controlId:"password",children:[e(i.Label,{children:"Password"}),e(i.Control,{type:"password",placeholder:"Enter password",value:a,required:!0,onChange:C=>{s(!1),c(C.target.value)}})]}),n(F,{className:"py-3",children:[e(E,{children:e(D,{type:"submit",variant:"primary",children:"Sign In"})}),e(E,{children:e(D,{type:"reset",variant:"primary",children:"Reset"})})]}),n(F,{children:[n(E,{children:["New User?"," ",e(x,{to:f?`/signup?redirect=${f}`:"/signup",children:"Register Here"})]}),n(E,{children:["Forgot Password?"," ",e(x,{to:f?`/forgotpassword?redirect=${f}`:"/forgotpassword",children:"Click here"})]})]})]})]})})})})},$e=()=>{const[t,r]=l.exports.useState(""),[a,c]=l.exports.useState(""),[o,s]=l.exports.useState(""),[h,g]=l.exports.useState(""),[f,d]=l.exports.useState("voter"),[p,b]=l.exports.useState(!1),y=Q(),w=X(),$=y.search?y.search.split("=")[1]:"/",{isAuth:C,setIsAuth:k,loading:K,setLoading:S}=l.exports.useContext(N);return l.exports.useEffect(()=>{k("token"in localStorage),C&&(S(!1),w("/dashboard",{replace:!0}))},[C]),e(I,{children:K?e(M,{}):e(I,{children:e("div",{children:n(ee,{children:[e("h1",{children:"SignUp"}),p&&e(q,{variant:"danger",children:p}),n(i,{onSubmit:async u=>{u.preventDefault(),S(!0);try{await qe({username:a,email:o,password:h,name:t,userType:f}),k("token"in localStorage)}catch(B){console.log(B),B.response&&B.response.data.message?b(B.response.data.message):b(B.message)}S(!1)},onReset:u=>{u.preventDefault(),r(""),c(""),s(""),g(""),d("voter")},children:[n(i.Group,{controlId:"name",children:[e(i.Label,{children:"Name"}),e(i.Control,{type:"text",placeholder:"Enter name",value:t,required:!0,onChange:u=>{b(!1),r(u.target.value)}})]}),n(i.Group,{controlId:"username",children:[e(i.Label,{children:"Username"}),e(i.Control,{type:"text",placeholder:"Enter username",value:a,required:!0,onChange:u=>{b(!1),c(u.target.value)}})]}),n(i.Group,{controlId:"email",children:[e(i.Label,{children:"Email Address"}),e(i.Control,{type:"email",placeholder:"Enter email",value:o,required:!0,onChange:u=>{b(!1),s(u.target.value)}})]}),n(i.Group,{controlId:"password",children:[e(i.Label,{children:"Password"}),e(i.Control,{type:"password",placeholder:"Enter password",value:h,required:!0,onChange:u=>{b(!1),g(u.target.value)}})]}),n(F,{className:"py-3",children:[e(E,{children:e(D,{type:"submit",variant:"primary",children:"Sign Up"})}),e(E,{children:e(D,{type:"reset",variant:"primary",children:"Reset"})})]}),e(F,{children:n(E,{children:["Already registered?"," ",e(x,{to:$?`/login?redirect=${$}`:"/signup",children:"Login Here"})]})})]})]})})})})},Be=t=>{const{show:r,setShow:a}=t,[c,o]=m.useState({organisationName:""}),s=f=>{o(A(P({},c),{[f.target.name]:f.target.value}))},h=f=>{f.preventDefault(),g()&&console.log(c)},g=()=>c.organisationName.length<4?(j.error(se("Organiser Name","must be at least 4 characters long"),{position:j.POSITION.BOTTOM_RIGHT}),!1):!0;return n(W,{size:"lg",show:r,onHide:()=>a(!1),"aria-labelledby":"createOrganiserModal",children:[e(W.Header,{closeButton:!0,children:e(W.Title,{id:"createOrganiserModal",children:"Create Organiser"})}),e(W.Body,{children:n(i,{children:[e(we,{label:"Organiser name",className:"mb-3",children:e(i.Control,{type:"text",name:"organisationName",value:c.organisationName,onChange:s,required:!0})}),e(D,{className:"text-center",variant:"primary",type:"submit",onClick:h,children:"Create"})]})})]})};async function Ge(t){try{const{data:r}=await O.get(`${H}/voters/${t}`);return console.log(r),r}catch(r){return console.log(r),null}}const je=async(t,r)=>{const a=localStorage.getItem("token"),c={headers:{"Content-type":"application/json",Authorization:`Bearer ${a}`}},o=A(P({},t),{organiser:r,registrationLink:"https://dvoting.github.io"});console.log(o);try{const{data:s}=await O.post(`${H}/elections`,o,c);return s}catch(s){throw console.log(s),s}};async function Ue(t){try{return[]}catch(r){return console.log(r),null}}async function Ve(t){try{return[]}catch(r){return console.log(r),null}}async function We(t){try{return[]}catch(r){return console.log(r),null}}const _e=()=>{const{user:t,loading:r,setLoading:a}=m.useContext(N),[c,o]=m.useState(!1),[s,h]=m.useState(null),[g,f]=m.useState([]),[d,p]=m.useState([]),[b,y]=m.useState([]);return m.useEffect(()=>{a(t===null),console.log(t)},[t]),m.useEffect(async()=>{t&&h(await Ge(t.uniqueVoterId))},[t]),m.useEffect(async()=>{t&&f(await Ue(t.uniqueVoterId))},[t]),m.useEffect(async()=>{t&&p(await Ve(t.uniqueVoterId))},[t]),m.useEffect(async()=>{t&&y(await We(t.uniqueVoterId))},[t]),e(m.Fragment,{children:r?e(M,{}):e(m.Fragment,{children:e(U,{children:n(F,{children:[n(E,{md:12,lg:4,children:[e(R,{children:t&&n(m.Fragment,{children:[e(R.Header,{children:"User Profile"}),n(v,{variant:"flush",children:[n(v.Item,{children:["Username: ",t.username]}),n(v.Item,{children:["Name: ",t.name]}),n(v.Item,{children:["E-mail: ",t.email," ",t.emailVerified?e("span",{className:"text-success",children:"verified"}):e(x,{to:"#",children:"verify"})]}),n(v.Item,{children:["UVID: ",t.uniqueVoterId]}),s&&n(v.Item,{children:["Wallet:"," ",s.hasWallet?e("span",{className:"text-success",children:"assigned"}):e(x,{to:"#",children:"generate"})]}),e(v.Item,{children:e(x,{to:"#",children:"Change Password"})})]})]})}),e(R,{style:{marginTop:"5%",marginBottom:"5%"},children:t&&n(v,{variant:"flush",children:[t.userType==="voter"&&n(m.Fragment,{children:[e(v.Item,{onClick:()=>o(!0),style:{cursor:"pointer"},children:"Register an Organisation"}),e(Be,{show:c,setShow:o})]}),t.userType==="organiser"&&e(x,{to:"#",children:e(v.Item,{children:"Manage Organisations"})})]})})]}),e(E,{md:12,lg:8,children:n(R,{children:[e(R.Header,{children:"Elections"}),e(R.Body,{children:s&&n(be,{defaultActiveKey:"approved",className:"mb-3",children:[e(_,{eventKey:"approved",title:"Appeared",children:d.length>0?e(v,{variant:"flush",children:d.map(w=>e(x,{to:"#",children:e(v.Item,{children:w})},w))}):e(m.Fragment,{children:"Nothing here... "})}),e(_,{eventKey:"invited",title:"Invited",children:s.invitations&&s.invitations.length>0?e(v,{variant:"flush",children:s.invitations.map(w=>e(x,{to:"#",children:e(v.Item,{children:w})},w))}):e(m.Fragment,{children:"Nothing here... "})}),e(_,{eventKey:"applies",title:"Applied",children:g.length>0?e(v,{variant:"flush",children:g.map(w=>e(x,{to:"#",children:e(v.Item,{children:w})},w))}):e(m.Fragment,{children:"Nothing here... "})}),e(_,{eventKey:"appeared",title:"Appeared",children:b.length>0?e(v,{variant:"flush",children:b.map(w=>e(x,{to:"#",children:e(v.Item,{children:w})},w))}):e(m.Fragment,{children:"Nothing here... "})})]})})]})})]})})})})},Ke=()=>{const t=Q();return console.log(t),e("div",{children:"Election Details Page"})};const ze=()=>{const[t,r]=l.exports.useState({title:"",openTimestamp:new Date,closeTimestamp:new Date}),[a,c]=l.exports.useState(null),[o,s]=l.exports.useState(null),{user:h}=l.exports.useContext(N),g=async d=>{d.preventDefault();try{const p=await je(t,h._id),{_id:b}=p;c(`/elections/${b}`)}catch(p){console.log(p.response),s(p.response.data)}},f=d=>{d.preventDefault(),c("/dashboard")};return a?e(Y,{to:a,replace:!0}):n("div",{className:"d-flex flex-column justify-content-center align-items-center",style:{height:"70vh"},children:[e("h2",{className:"my-5",children:"Create an Election"}),n(i,{onSubmit:g,onReset:f,className:"bg-light rounded px-4 py-4",style:{background:"pink",minWidth:"40%"},children:[n(i.Group,{className:"my-4",controlId:"electionTitle",children:[e(i.Label,{children:"Title"}),e(i.Control,{type:"text",placeholder:"Enter election title",value:t.title,onChange:d=>{r(p=>A(P({},p),{title:d.target.value}))}})]}),n("div",{className:"my-4",children:[e("label",{children:"Election Start Time"}),e("br",{}),e(ae,{className:"w-100",onChange:d=>{r(p=>A(P({},p),{openTimestamp:d}))},value:t.openTimestamp,minDate:new Date,required:!0})]}),n("div",{className:"my-4",children:[e("label",{children:"Election End Time"}),e("br",{}),e(ae,{className:"w-100",onChange:d=>{r(p=>A(P({},p),{closeTimestamp:d}))},value:t.closeTimestamp,minDate:t.openTimestamp})]}),e("br",{}),n("div",{className:"d-flex justify-content-center",children:[e(D,{variant:"secondary",type:"reset",className:"mx-4 px-3",children:"Discard"}),e(D,{variant:"success",type:"submit",className:"mx-4 px-4",children:"Save"})]})]}),o&&e(q,{variant:"danger",children:o})]})},Je=[{name:"Email not entered",value:"1"},{name:"OTP sent from server",value:"2"},{name:"Change password",value:"3"}],Qe=async t=>{try{const r={headers:{"Content-Type":"application/json"}};return(await O.put(`${H}/otp`,t,r)).data}catch(r){throw r}},Xe=async t=>{try{const r={headers:{"Content-Type":"application/json"}};return(await O.patch(`${H}/otp/verify`,t,r)).data}catch(r){throw r}},Ye=async t=>{try{const r={headers:{"Content-Type":"application/json"}};return(await O.put(`${H}/users/profile`,t,r)).data}catch(r){throw r}},Ze=()=>{const[t,r]=l.exports.useState(""),[a,c]=l.exports.useState(""),[o,s]=l.exports.useState(""),[h,g]=l.exports.useState(""),[f,d]=l.exports.useState(!1),[p,b]=l.exports.useState(!1),[y,w]=l.exports.useState(Je[0].value),$=X(),{isAuth:C,setIsAuth:k,loading:K,setLoading:S}=l.exports.useContext(N);return l.exports.useEffect(()=>{k("token"in localStorage),C&&(S(!1),$("/dashboard",{replace:!0}))},[C]),e(I,{children:K?e(M,{}):e(I,{children:e("div",{children:n(ee,{children:[e("h1",{children:"Forgot Password"}),p&&e(q,{variant:"success",children:p}),f&&e(q,{variant:"danger",children:f}),n(i,{onSubmit:async L=>{if(L.preventDefault(),d(!1),b(!1),o!==h){d("Passwords don't match");return}switch(y){case"1":S(!0);try{await Qe({email:t}),w("2")}catch(u){console.log(u),u.response&&u.response.data.message?d(u.response.data.message):d(u.message)}S(!1);break;case"2":S(!0);try{await Xe({email:t,otp:a}),w("3")}catch(u){console.log(u),u.response&&u.response.data.message?d(u.response.data.message):d(u.message)}S(!1);break;case"3":S(!0);try{await Ye({email:t,password:o}),b("Password has been changed")}catch(u){console.log(u),u.response&&u.response.data.message?d(u.response.data.message):d(u.message)}S(!1);break}},children:[(y==="1"||y==="2")&&n(i.Group,{controlId:"email",children:[e(i.Label,{children:"Email Address"}),e(i.Control,{type:"email",placeholder:"Enter your email",value:t,required:!0,onChange:L=>{d(!1),r(L.target.value)}})]}),y==="2"&&n(i.Group,{controlId:"otp",children:[e(i.Label,{children:"OTP"}),e(i.Control,{type:"text",placeholder:"Enter OTP received on email",value:a,required:!0,onChange:L=>{d(!1),c(L.target.value)}})]}),y==="3"&&n(i.Group,{controlId:"password",children:[e(i.Label,{children:"Password"}),e(i.Control,{type:"password",placeholder:"Enter new Password",value:o,required:!0,onChange:L=>{d(!1),s(L.target.value)}})]}),y==="3"&&n(i.Group,{controlId:"confirmPassword",children:[e(i.Label,{children:"Confirm Password"}),e(i.Control,{type:"password",placeholder:"Confirm your new Password",value:h,required:!0,onChange:L=>{d(!1),g(L.target.value)}})]}),e(F,{className:"py-3",children:e(E,{children:e(D,{type:"submit",variant:"primary",children:y=="1"?"Send OTP":y=="2"?"Confirm OTP":"Change Password"})})})]})]})})})})};var et="/assets/fourOfour.e2f25f95.jpeg";const tt=()=>{const{loading:t,isAuth:r,setIsAuth:a}=l.exports.useContext(N);return l.exports.useEffect(()=>{a("token"in localStorage)}),e("div",{children:t?e(M,{}):n(I,{children:[n(x,{to:r?"/dashboard":"/",children:[e(Ce,{}),"Go back to the home page"]}),e("img",{src:et})]})})},rt=()=>{const{user:t,setUser:r,setIsAuth:a,setLoading:c}=l.exports.useContext(N),o=localStorage.getItem("token"),[s,h]=l.exports.useState(!1);return l.exports.useEffect(()=>{(async()=>{if(o&&!t){const g=await Re();g.error?(a(!1),c(!1),h(!0)):(r(g),a(!0))}})()},[o]),s?(localStorage.removeItem("token"),e(Y,{to:"/"})):(console.log("via private route"),o?e(xe,{}):e(Y,{to:"/login"}))},nt=()=>n(Se,{children:[e("main",{className:"App py-3 bg-gray",children:n(U,{children:[e(De,{}),n(Ie,{children:[e(T,{path:"*",element:e(tt,{})}),e(T,{exact:!0,path:"/",element:e(He,{})}),e(T,{path:"/login",element:e(Me,{})}),e(T,{path:"/signup",element:e($e,{})}),e(T,{path:"/forgotpassword",element:e(Ze,{})}),n(T,{path:"/",element:e(rt,{}),children:[e(T,{exact:!0,path:"/dashboard",element:e(_e,{})}),e(T,{exact:!0,path:"/elections/:id",element:e(Ke,{})}),e(T,{exact:!0,path:"/create-election",element:e(ze,{})})]})]})]})}),e(Ee,{style:{width:"25em"}})]});Ne.render(e(Le,{children:e(nt,{})}),document.getElementById("root"));
